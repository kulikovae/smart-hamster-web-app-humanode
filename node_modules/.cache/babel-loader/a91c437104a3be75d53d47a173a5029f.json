{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fetchJson = void 0;\n\nconst http_errors_1 = __importDefault(require(\"http-errors\"));\n\nconst exponential_backoff_1 = __importDefault(require(\"./exponential-backoff\"));\n\nconst providers_1 = require(\"../providers\");\n\nconst errors_1 = require(\"./errors\");\n\nconst START_WAIT_TIME_MS = 1000;\nconst BACKOFF_MULTIPLIER = 1.5;\nconst RETRY_NUMBER = 10;\n\nfunction fetchJson(connectionInfoOrUrl, json) {\n  return __awaiter(this, void 0, void 0, function* () {\n    let connectionInfo = {\n      url: null\n    };\n\n    if (typeof connectionInfoOrUrl === 'string') {\n      connectionInfo.url = connectionInfoOrUrl;\n    } else {\n      connectionInfo = connectionInfoOrUrl;\n    }\n\n    const response = yield (0, exponential_backoff_1.default)(START_WAIT_TIME_MS, RETRY_NUMBER, BACKOFF_MULTIPLIER, () => __awaiter(this, void 0, void 0, function* () {\n      try {\n        const response = yield fetch(connectionInfo.url, {\n          method: json ? 'POST' : 'GET',\n          body: json ? json : undefined,\n          headers: Object.assign(Object.assign({}, connectionInfo.headers), {\n            'Content-Type': 'application/json'\n          })\n        });\n\n        if (!response.ok) {\n          if (response.status === 503) {\n            (0, errors_1.logWarning)(`Retrying HTTP request for ${connectionInfo.url} as it's not available now`);\n            return null;\n          }\n\n          throw (0, http_errors_1.default)(response.status, yield response.text());\n        }\n\n        return response;\n      } catch (error) {\n        if (error.toString().includes('FetchError') || error.toString().includes('Failed to fetch')) {\n          (0, errors_1.logWarning)(`Retrying HTTP request for ${connectionInfo.url} because of error: ${error}`);\n          return null;\n        }\n\n        throw error;\n      }\n    }));\n\n    if (!response) {\n      throw new providers_1.TypedError(`Exceeded ${RETRY_NUMBER} attempts for ${connectionInfo.url}.`, 'RetriesExceeded');\n    }\n\n    return yield response.json();\n  });\n}\n\nexports.fetchJson = fetchJson;","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__importDefault","mod","__esModule","Object","defineProperty","exports","fetchJson","http_errors_1","require","exponential_backoff_1","providers_1","errors_1","START_WAIT_TIME_MS","BACKOFF_MULTIPLIER","RETRY_NUMBER","connectionInfoOrUrl","json","connectionInfo","url","response","default","fetch","method","body","undefined","headers","assign","ok","status","logWarning","text","error","toString","includes","TypedError"],"sources":["/Users/loyanix/projects/smart-hamster-web-app/node_modules/near-api-js/lib/utils/web.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fetchJson = void 0;\nconst http_errors_1 = __importDefault(require(\"http-errors\"));\nconst exponential_backoff_1 = __importDefault(require(\"./exponential-backoff\"));\nconst providers_1 = require(\"../providers\");\nconst errors_1 = require(\"./errors\");\nconst START_WAIT_TIME_MS = 1000;\nconst BACKOFF_MULTIPLIER = 1.5;\nconst RETRY_NUMBER = 10;\nfunction fetchJson(connectionInfoOrUrl, json) {\n    return __awaiter(this, void 0, void 0, function* () {\n        let connectionInfo = { url: null };\n        if (typeof (connectionInfoOrUrl) === 'string') {\n            connectionInfo.url = connectionInfoOrUrl;\n        }\n        else {\n            connectionInfo = connectionInfoOrUrl;\n        }\n        const response = yield (0, exponential_backoff_1.default)(START_WAIT_TIME_MS, RETRY_NUMBER, BACKOFF_MULTIPLIER, () => __awaiter(this, void 0, void 0, function* () {\n            try {\n                const response = yield fetch(connectionInfo.url, {\n                    method: json ? 'POST' : 'GET',\n                    body: json ? json : undefined,\n                    headers: Object.assign(Object.assign({}, connectionInfo.headers), { 'Content-Type': 'application/json' })\n                });\n                if (!response.ok) {\n                    if (response.status === 503) {\n                        (0, errors_1.logWarning)(`Retrying HTTP request for ${connectionInfo.url} as it's not available now`);\n                        return null;\n                    }\n                    throw (0, http_errors_1.default)(response.status, yield response.text());\n                }\n                return response;\n            }\n            catch (error) {\n                if (error.toString().includes('FetchError') || error.toString().includes('Failed to fetch')) {\n                    (0, errors_1.logWarning)(`Retrying HTTP request for ${connectionInfo.url} because of error: ${error}`);\n                    return null;\n                }\n                throw error;\n            }\n        }));\n        if (!response) {\n            throw new providers_1.TypedError(`Exceeded ${RETRY_NUMBER} attempts for ${connectionInfo.url}.`, 'RetriesExceeded');\n        }\n        return yield response.json();\n    });\n}\nexports.fetchJson = fetchJson;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}